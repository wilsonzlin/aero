// A tiny built-in bitmap font.
//
// This is the public domain "font8x8_basic" table used in many hobby OSes,
// scaled to 8x16 by duplicating rows.
//
// Each entry is 8 bytes, one per row. Bit 7 is the left-most pixel.
#[rustfmt::skip]
pub const FONT8X8_BASIC: [[u8; 8]; 128] = [
    [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00], // 0x00
    [0x7E,0x81,0xA5,0x81,0xBD,0x99,0x81,0x7E], // 0x01
    [0x7E,0xFF,0xDB,0xFF,0xC3,0xE7,0xFF,0x7E], // 0x02
    [0x6C,0xFE,0xFE,0xFE,0x7C,0x38,0x10,0x00], // 0x03
    [0x10,0x38,0x7C,0xFE,0x7C,0x38,0x10,0x00], // 0x04
    [0x38,0x7C,0x38,0xFE,0xFE,0xD6,0x10,0x38], // 0x05
    [0x10,0x38,0x7C,0xFE,0xFE,0x7C,0x10,0x38], // 0x06
    [0x00,0x00,0x18,0x3C,0x3C,0x18,0x00,0x00], // 0x07
    [0xFF,0xFF,0xE7,0xC3,0xC3,0xE7,0xFF,0xFF], // 0x08
    [0x00,0x3C,0x66,0x42,0x42,0x66,0x3C,0x00], // 0x09
    [0xFF,0xC3,0x99,0xBD,0xBD,0x99,0xC3,0xFF], // 0x0A
    [0x0F,0x07,0x0F,0x7D,0xCC,0xCC,0xCC,0x78], // 0x0B
    [0x3C,0x66,0x66,0x66,0x3C,0x18,0x7E,0x18], // 0x0C
    [0x3F,0x33,0x3F,0x30,0x30,0x70,0xF0,0xE0], // 0x0D
    [0x7F,0x63,0x7F,0x63,0x63,0x67,0xE6,0xC0], // 0x0E
    [0x99,0x5A,0x3C,0xE7,0xE7,0x3C,0x5A,0x99], // 0x0F
    [0x80,0xE0,0xF8,0xFE,0xF8,0xE0,0x80,0x00], // 0x10
    [0x02,0x0E,0x3E,0xFE,0x3E,0x0E,0x02,0x00], // 0x11
    [0x18,0x3C,0x7E,0x18,0x18,0x7E,0x3C,0x18], // 0x12
    [0x66,0x66,0x66,0x66,0x66,0x00,0x66,0x00], // 0x13
    [0x7F,0xDB,0xDB,0x7B,0x1B,0x1B,0x1B,0x00], // 0x14
    [0x3E,0x63,0x38,0x6C,0x6C,0x38,0xCC,0x78], // 0x15
    [0x00,0x00,0x00,0x00,0x7E,0x7E,0x7E,0x00], // 0x16
    [0x18,0x3C,0x7E,0x18,0x7E,0x3C,0x18,0xFF], // 0x17
    [0x18,0x3C,0x7E,0x18,0x18,0x18,0x18,0x00], // 0x18
    [0x18,0x18,0x18,0x18,0x7E,0x3C,0x18,0x00], // 0x19
    [0x00,0x18,0x0C,0xFE,0x0C,0x18,0x00,0x00], // 0x1A
    [0x00,0x30,0x60,0xFE,0x60,0x30,0x00,0x00], // 0x1B
    [0x00,0x00,0xC0,0xC0,0xC0,0xFE,0x00,0x00], // 0x1C
    [0x00,0x24,0x66,0xFF,0x66,0x24,0x00,0x00], // 0x1D
    [0x00,0x18,0x3C,0x7E,0xFF,0xFF,0x00,0x00], // 0x1E
    [0x00,0xFF,0xFF,0x7E,0x3C,0x18,0x00,0x00], // 0x1F
    [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00], // 0x20 ' '
    [0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00], // 0x21 '!'
    [0x6C,0x6C,0x24,0x00,0x00,0x00,0x00,0x00], // 0x22 '"'
    [0x6C,0x6C,0xFE,0x6C,0xFE,0x6C,0x6C,0x00], // 0x23 '#'
    [0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00], // 0x24 '$'
    [0x00,0xC6,0xCC,0x18,0x30,0x66,0xC6,0x00], // 0x25 '%'
    [0x38,0x6C,0x38,0x76,0xDC,0xCC,0x76,0x00], // 0x26 '&'
    [0x30,0x30,0x60,0x00,0x00,0x00,0x00,0x00], // 0x27 '''
    [0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00], // 0x28 '('
    [0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00], // 0x29 ')'
    [0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00], // 0x2A '*'
    [0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00], // 0x2B '+'
    [0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30], // 0x2C ','
    [0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00], // 0x2D '-'
    [0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00], // 0x2E '.'
    [0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00], // 0x2F '/'
    [0x7C,0xC6,0xCE,0xDE,0xF6,0xE6,0x7C,0x00], // 0x30 '0'
    [0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00], // 0x31 '1'
    [0x7C,0xC6,0x06,0x1C,0x70,0xC0,0xFE,0x00], // 0x32 '2'
    [0x7C,0xC6,0x06,0x3C,0x06,0xC6,0x7C,0x00], // 0x33 '3'
    [0x1C,0x3C,0x6C,0xCC,0xFE,0x0C,0x1E,0x00], // 0x34 '4'
    [0xFE,0xC0,0xFC,0x06,0x06,0xC6,0x7C,0x00], // 0x35 '5'
    [0x3C,0x60,0xC0,0xFC,0xC6,0xC6,0x7C,0x00], // 0x36 '6'
    [0xFE,0xC6,0x0C,0x18,0x30,0x30,0x30,0x00], // 0x37 '7'
    [0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00], // 0x38 '8'
    [0x7C,0xC6,0xC6,0x7E,0x06,0x0C,0x78,0x00], // 0x39 '9'
    [0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00], // 0x3A ':'
    [0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x30], // 0x3B ';'
    [0x0E,0x1C,0x38,0x70,0x38,0x1C,0x0E,0x00], // 0x3C '<'
    [0x00,0x00,0x7E,0x00,0x00,0x7E,0x00,0x00], // 0x3D '='
    [0x70,0x38,0x1C,0x0E,0x1C,0x38,0x70,0x00], // 0x3E '>'
    [0x7C,0xC6,0x0E,0x1C,0x18,0x00,0x18,0x00], // 0x3F '?'
    [0x7C,0xC6,0xDE,0xDE,0xDE,0xC0,0x78,0x00], // 0x40 '@'
    [0x38,0x6C,0xC6,0xC6,0xFE,0xC6,0xC6,0x00], // 0x41 'A'
    [0xFC,0x66,0x66,0x7C,0x66,0x66,0xFC,0x00], // 0x42 'B'
    [0x3C,0x66,0xC0,0xC0,0xC0,0x66,0x3C,0x00], // 0x43 'C'
    [0xF8,0x6C,0x66,0x66,0x66,0x6C,0xF8,0x00], // 0x44 'D'
    [0xFE,0x62,0x68,0x78,0x68,0x62,0xFE,0x00], // 0x45 'E'
    [0xFE,0x62,0x68,0x78,0x68,0x60,0xF0,0x00], // 0x46 'F'
    [0x3C,0x66,0xC0,0xC0,0xCE,0x66,0x3E,0x00], // 0x47 'G'
    [0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00], // 0x48 'H'
    [0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x00], // 0x49 'I'
    [0x1E,0x0C,0x0C,0x0C,0xCC,0xCC,0x78,0x00], // 0x4A 'J'
    [0xE6,0x66,0x6C,0x78,0x6C,0x66,0xE6,0x00], // 0x4B 'K'
    [0xF0,0x60,0x60,0x60,0x62,0x66,0xFE,0x00], // 0x4C 'L'
    [0xC6,0xEE,0xFE,0xFE,0xD6,0xC6,0xC6,0x00], // 0x4D 'M'
    [0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0xC6,0x00], // 0x4E 'N'
    [0x38,0x6C,0xC6,0xC6,0xC6,0x6C,0x38,0x00], // 0x4F 'O'
    [0xFC,0x66,0x66,0x7C,0x60,0x60,0xF0,0x00], // 0x50 'P'
    [0x38,0x6C,0xC6,0xC6,0xDA,0xCC,0x76,0x00], // 0x51 'Q'
    [0xFC,0x66,0x66,0x7C,0x6C,0x66,0xE6,0x00], // 0x52 'R'
    [0x7C,0xC6,0x60,0x38,0x0C,0xC6,0x7C,0x00], // 0x53 'S'
    [0x7E,0x7E,0x5A,0x18,0x18,0x18,0x3C,0x00], // 0x54 'T'
    [0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00], // 0x55 'U'
    [0xC6,0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x00], // 0x56 'V'
    [0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00], // 0x57 'W'
    [0xC6,0xC6,0x6C,0x38,0x38,0x6C,0xC6,0x00], // 0x58 'X'
    [0x66,0x66,0x66,0x3C,0x18,0x18,0x3C,0x00], // 0x59 'Y'
    [0xFE,0xC6,0x8C,0x18,0x32,0x66,0xFE,0x00], // 0x5A 'Z'
    [0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00], // 0x5B '['
    [0xC0,0x60,0x30,0x18,0x0C,0x06,0x02,0x00], // 0x5C '\'
    [0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00], // 0x5D ']'
    [0x10,0x38,0x6C,0xC6,0x00,0x00,0x00,0x00], // 0x5E '^'
    [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF], // 0x5F '_'
    [0x30,0x18,0x0C,0x00,0x00,0x00,0x00,0x00], // 0x60 '`'
    [0x00,0x00,0x7C,0x06,0x7E,0xC6,0x7E,0x00], // 0x61 'a'
    [0xE0,0x60,0x7C,0x66,0x66,0x66,0xDC,0x00], // 0x62 'b'
    [0x00,0x00,0x7C,0xC6,0xC0,0xC6,0x7C,0x00], // 0x63 'c'
    [0x1C,0x0C,0x7C,0xCC,0xCC,0xCC,0x76,0x00], // 0x64 'd'
    [0x00,0x00,0x7C,0xC6,0xFE,0xC0,0x7C,0x00], // 0x65 'e'
    [0x3C,0x66,0x60,0xF8,0x60,0x60,0xF0,0x00], // 0x66 'f'
    [0x00,0x00,0x76,0xCC,0xCC,0x7C,0x0C,0xF8], // 0x67 'g'
    [0xE0,0x60,0x6C,0x76,0x66,0x66,0xE6,0x00], // 0x68 'h'
    [0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00], // 0x69 'i'
    [0x06,0x00,0x06,0x06,0x06,0xC6,0xC6,0x7C], // 0x6A 'j'
    [0xE0,0x60,0x66,0x6C,0x78,0x6C,0xE6,0x00], // 0x6B 'k'
    [0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00], // 0x6C 'l'
    [0x00,0x00,0xCC,0xFE,0xFE,0xD6,0xC6,0x00], // 0x6D 'm'
    [0x00,0x00,0xDC,0x66,0x66,0x66,0x66,0x00], // 0x6E 'n'
    [0x00,0x00,0x7C,0xC6,0xC6,0xC6,0x7C,0x00], // 0x6F 'o'
    [0x00,0x00,0xDC,0x66,0x66,0x7C,0x60,0xF0], // 0x70 'p'
    [0x00,0x00,0x76,0xCC,0xCC,0x7C,0x0C,0x1E], // 0x71 'q'
    [0x00,0x00,0xDC,0x76,0x66,0x60,0xF0,0x00], // 0x72 'r'
    [0x00,0x00,0x7E,0xC0,0x7C,0x06,0xFC,0x00], // 0x73 's'
    [0x30,0x30,0xFC,0x30,0x30,0x36,0x1C,0x00], // 0x74 't'
    [0x00,0x00,0xCC,0xCC,0xCC,0xCC,0x76,0x00], // 0x75 'u'
    [0x00,0x00,0xC6,0xC6,0xC6,0x6C,0x38,0x00], // 0x76 'v'
    [0x00,0x00,0xC6,0xD6,0xFE,0xFE,0x6C,0x00], // 0x77 'w'
    [0x00,0x00,0xC6,0x6C,0x38,0x6C,0xC6,0x00], // 0x78 'x'
    [0x00,0x00,0xC6,0xC6,0xC6,0x7E,0x06,0xFC], // 0x79 'y'
    [0x00,0x00,0xFE,0x4C,0x18,0x32,0xFE,0x00], // 0x7A 'z'
    [0x0E,0x18,0x18,0x70,0x18,0x18,0x0E,0x00], // 0x7B '{'
    [0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00], // 0x7C '|'
    [0x70,0x18,0x18,0x0E,0x18,0x18,0x70,0x00], // 0x7D '}'
    [0x76,0xDC,0x00,0x00,0x00,0x00,0x00,0x00], // 0x7E '~'
    [0x00,0x10,0x38,0x6C,0xC6,0xC6,0xFE,0x00], // 0x7F (del)
];

// ----------------------------------------------------------------------------------------------
// CP437 extensions
// ----------------------------------------------------------------------------------------------

/// A CP437-compatible 8x8 font table.
///
/// The first 128 entries (0x00..=0x7F) are copied verbatim from [`FONT8X8_BASIC`] so that the
/// existing ASCII output (and golden hashes) stay stable.
///
/// The extended range is currently populated with common CP437 text UI glyphs:
/// - Shading (`0xB0..=0xB2`)
/// - Box drawing (`0xB3..=0xDF`)
///
/// The `aero-gpu-vga` text renderer scales this 8x8 font to 8x16 by duplicating rows.
pub const FONT8X8_CP437: [[u8; 8]; 256] = build_font8x8_cp437();

const fn build_font8x8_cp437() -> [[u8; 8]; 256] {
    let mut font = [[0u8; 8]; 256];

    // Preserve the original 0x00..=0x7F glyphs byte-for-byte.
    let mut i = 0usize;
    while i < 128 {
        font[i] = FONT8X8_BASIC[i];
        i += 1;
    }

    // CP437 shading characters.
    font[0xB0] = glyph_shade_light(); // ░
    font[0xB1] = glyph_shade_medium(); // ▒
    font[0xB2] = glyph_shade_dark(); // ▓

    // CP437 single-line box drawing.
    font[0xB3] = glyph_box_single(true, true, false, false); // │
    font[0xB4] = glyph_box_single(true, true, true, false); // ┤
    font[0xBF] = glyph_box_single(false, true, true, false); // ┐
    font[0xC0] = glyph_box_single(true, false, false, true); // └
    font[0xC1] = glyph_box_single(true, false, true, true); // ┴
    font[0xC2] = glyph_box_single(false, true, true, true); // ┬
    font[0xC3] = glyph_box_single(true, true, false, true); // ├
    font[0xC4] = glyph_box_single(false, false, true, true); // ─
    font[0xC5] = glyph_box_single(true, true, true, true); // ┼
    font[0xD9] = glyph_box_single(true, false, true, false); // ┘
    font[0xDA] = glyph_box_single(false, true, false, true); // ┌

    // CP437 double-line/mixed box drawing.
    //
    // These are approximated using the same "single-line" strokes; the primary goal is to avoid
    // rendering them as blanks in boot-time text UIs.
    font[0xB5] = glyph_box_single(true, true, true, false); // ╡
    font[0xB6] = glyph_box_single(true, true, true, false); // ╢
    font[0xB7] = glyph_box_single(false, true, true, false); // ╖
    font[0xB8] = glyph_box_single(false, true, true, false); // ╕
    font[0xB9] = glyph_box_single(true, true, true, false); // ╣
    font[0xBA] = glyph_box_double_vertical(); // ║
    font[0xBB] = glyph_box_single(false, true, true, false); // ╗
    font[0xBC] = glyph_box_single(true, false, true, false); // ╝
    font[0xBD] = glyph_box_single(true, false, true, false); // ╜
    font[0xBE] = glyph_box_single(true, false, true, false); // ╛

    // These are in the EGA "line graphics" range (0xC0..=0xDF) and participate in VGA 9th-column
    // replication when the Attribute Controller's "line graphics enable" bit is set.
    font[0xC6] = glyph_box_single(true, true, false, true); // ╞
    font[0xC7] = glyph_box_single(true, true, false, true); // ╟
    font[0xC8] = glyph_box_single(true, false, false, true); // ╚
    font[0xC9] = glyph_box_single(false, true, false, true); // ╔
    font[0xCA] = glyph_box_single(true, false, true, true); // ╩
    font[0xCB] = glyph_box_single(false, true, true, true); // ╦
    font[0xCC] = glyph_box_single(true, true, false, true); // ╠
    font[0xCD] = glyph_box_single(false, false, true, true); // ═
    font[0xCE] = glyph_box_single(true, true, true, true); // ╬
    font[0xCF] = glyph_box_single(true, false, true, true); // ╧
    font[0xD0] = glyph_box_single(true, false, true, true); // ╨
    font[0xD1] = glyph_box_single(false, true, true, true); // ╤
    font[0xD2] = glyph_box_single(false, true, true, true); // ╥
    font[0xD3] = glyph_box_single(true, false, false, true); // ╙
    font[0xD4] = glyph_box_single(true, false, false, true); // ╘
    font[0xD5] = glyph_box_single(false, true, false, true); // ╒
    font[0xD6] = glyph_box_single(false, true, false, true); // ╓
    font[0xD7] = glyph_box_single(true, true, true, true); // ╫
    font[0xD8] = glyph_box_single(true, true, true, true); // ╪

    // CP437 block elements.
    font[0xDB] = [0xFF; 8]; // █ full block
    font[0xDC] = glyph_block_lower_half(); // ▄
    font[0xDD] = glyph_block_left_half(); // ▌
    font[0xDE] = glyph_block_right_half(); // ▐
    font[0xDF] = glyph_block_upper_half(); // ▀

    font
}

const fn glyph_box_single(up: bool, down: bool, left: bool, right: bool) -> [u8; 8] {
    // A simple 8x8 "box drawing" generator. Lines are drawn centered within the cell:
    // - Horizontal line is at row 3.
    // - Vertical line is at column 3 (bit 4).
    //
    // This deliberately matches the assumptions in the VGA text renderer, which replicates the
    // 8th column into the 9th for 0xC0..=0xDF when line graphics are enabled.
    let mut out = [0u8; 8];
    let h_row = 3usize;
    let v_col = 3usize;
    let v_bit = 1u8 << (7 - v_col);
    let left_mask = 0xFFu8 << (7 - v_col);
    let right_mask = 0xFFu8 >> v_col;

    let mut y = 0usize;
    while y < 8 {
        let mut row = 0u8;
        if (up && y <= h_row) || (down && y >= h_row) {
            row |= v_bit;
        }
        if y == h_row {
            if left {
                row |= left_mask;
            }
            if right {
                row |= right_mask;
            }
        }
        out[y] = row;
        y += 1;
    }
    out
}

const fn glyph_box_double_vertical() -> [u8; 8] {
    // Approximate a double-vertical line by using a 2px wide stroke.
    let mut out = [0u8; 8];
    let v_bits = 0x18u8; // bits 4 and 3
    let mut y = 0usize;
    while y < 8 {
        out[y] = v_bits;
        y += 1;
    }
    out
}

const fn glyph_block_upper_half() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 4 {
        out[y] = 0xFF;
        y += 1;
    }
    out
}

const fn glyph_block_lower_half() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 4usize;
    while y < 8 {
        out[y] = 0xFF;
        y += 1;
    }
    out
}

const fn glyph_block_left_half() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 8 {
        out[y] = 0xF0; // left 4 pixels
        y += 1;
    }
    out
}

const fn glyph_block_right_half() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 8 {
        out[y] = 0x0F; // right 4 pixels
        y += 1;
    }
    out
}

const fn glyph_shade_light() -> [u8; 8] {
    // Approximate the CP437 shading characters. Exact density isn't critical as long as it's
    // visible in typical VGA palettes.
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 8 {
        out[y] = if (y & 1) == 0 { 0x00 } else { 0x55 };
        y += 1;
    }
    out
}

const fn glyph_shade_medium() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 8 {
        out[y] = if (y & 1) == 0 { 0x55 } else { 0xAA };
        y += 1;
    }
    out
}

const fn glyph_shade_dark() -> [u8; 8] {
    let mut out = [0u8; 8];
    let mut y = 0usize;
    while y < 8 {
        out[y] = if (y & 1) == 0 { 0xFF } else { 0xAA };
        y += 1;
    }
    out
}
