[package]
name = "emulator"
version = "0.1.0"
edition = "2021"
license = "MIT OR Apache-2.0"
[features]
default = []
aerogpu-native = ["dep:aero-gpu", "dep:pollster"]
aerogpu-exec = ["dep:anyhow", "dep:aero-d3d11", "dep:aero-gpu", "dep:pollster"]
# Alias for the WebGPU-backed AeroGPU command executor.
aerogpu-webgpu = ["aerogpu-exec"]
net-trace = []
# Enable verbose debug logging from the user-space network stack.
net_log = []
sinc-resampler = []
# Legacy audio stack (AC97/HDA/DSP + the old virtio-snd model). This is not part of the
# browser/WASM runtime path; it is retained for reference and for targeted tests.
legacy-audio = []
aerogpu-trace = ["dep:aero-gpu-trace"]
# Legacy AeroGPU PCI/MMIO bring-up device model + tests (legacy vendor 1AED).
aerogpu-legacy = []

[dependencies]
aero-usb = { path = "../aero-usb" }
aero-devices = { package = "devices", path = "../devices" }
aero-devices-input = { path = "../aero-devices-input" }
aero-edid = { path = "../aero-edid" }
aero-io-snapshot = { path = "../aero-io-snapshot" }
aero-snapshot = { path = "../aero-snapshot" }
aero-platform = { path = "../platform" }
aero-ipc = { path = "../aero-ipc", features = ["wasm"] }
aero-net-backend = { path = "../aero-net-backend" }
aero-gpu-trace = { path = "../aero-gpu-trace", optional = true }
aero-protocol = { path = "../../emulator/protocol" }
aero-gpu = { path = "../aero-gpu", optional = true }
aero-storage = { path = "../aero-storage" }
aero-storage-adapters = { path = "../aero-storage-adapters" }
anyhow = { version = "1", optional = true }
font8x8 = "0.3"
memory = { path = "../memory" }
aero-net-stack = { path = "../aero-net-stack" }
aero-net-e1000 = { path = "../aero-net-e1000" }
pollster = { version = "0.3", optional = true }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
thiserror = "1"
aero-d3d11 = { path = "../aero-d3d11", optional = true }

[dev-dependencies]
anyhow = "1"
image = { version = "0.25.5", default-features = false, features = ["png", "pnm"] }
tempfile = "3"
firmware = { path = "../firmware" }

[target.'cfg(not(target_arch = "wasm32"))'.dev-dependencies]
criterion = { version = "0.5.1", default-features = false, features = ["cargo_bench_support"] }
hyper = { version = "0.14", features = ["server", "http1", "tcp"] }
proptest = "1.4"
tokio = { version = "1", features = ["fs", "io-util", "macros", "net", "process", "rt-multi-thread", "sync", "time"] }

[[test]]
name = "boot_basic"
path = "../../tests/boot/basic_boot.rs"

[[test]]
name = "boot_sector"
path = "../../tests/boot_sector.rs"

[[test]]
name = "freedos_boot"
path = "../../tests/freedos_boot.rs"

[[test]]
name = "windows7_boot"
path = "../../tests/windows7_boot.rs"

[[bench]]
name = "dsp"
harness = false
required-features = ["legacy-audio"]

[[bench]]
name = "storage_sequential"
harness = false
