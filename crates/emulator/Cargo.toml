[package]
name = "emulator"
version = "0.1.0"
edition = "2021"
license = "MIT OR Apache-2.0"
[features]
default = []
aerogpu-native = ["dep:aero-gpu", "dep:pollster", "aero-devices-gpu/aerogpu-native"]
aerogpu-exec = ["dep:anyhow", "dep:aero-d3d11", "dep:aero-gpu", "dep:pollster"]
# Alias for the WebGPU-backed AeroGPU command executor.
aerogpu-webgpu = ["aerogpu-exec"]
net-trace = ["aero-net-trace/net-trace"]
# Enable verbose debug logging from the user-space network stack.
net_log = []
sinc-resampler = []
# Deprecated: canonical storage controller crates are now always used by the emulator.
#
# The legacy in-tree NVMe model has been removed; NVMe is always backed by `aero-devices-nvme`.
# This flag is retained as a no-op for backwards compatibility with existing build scripts.
storage-device-crates = []
# Legacy audio stack (AC97/HDA/DSP). This is not part of the browser/WASM runtime path; it is
# retained for reference and for targeted tests.
legacy-audio = []
# Legacy deterministic SMP/APIC model + snapshot harness.
#
# Note: retained as a no-op for backwards compatibility; the SMP model is now always available via
# `emulator::smp` and lives in `crates/aero-smp`.
legacy-smp-model = []
# Legacy emulator-specific PCI wrappers for `aero-usb` EHCI (USB 2.0) / xHCI (USB 3.x).
#
# The canonical PC platform uses `aero-devices` USB models instead; keep these wrappers behind
# explicit features to avoid new code depending on the legacy emulator integration.
legacy-usb-ehci = []
legacy-usb-xhci = []
aerogpu-trace = ["dep:aero-gpu-trace"]
# Legacy AeroGPU PCI/MMIO bring-up device model + tests (legacy vendor 1AED).
aerogpu-legacy = ["dep:aero-aerogpu", "aero-aerogpu/legacy-abi"]

[dependencies]
aero-machine = { path = "../aero-machine", default-features = false }
aero-usb = { path = "../aero-usb" }
aero-devices = { path = "../devices" }
aero-devices-input = { path = "../aero-devices-input" }
aero-devices-storage = { path = "../aero-devices-storage" }
aero-devices-nvme = { path = "../aero-devices-nvme" }
aero-devices-gpu = { path = "../aero-devices-gpu" }
aero-aerogpu = { path = "../aero-aerogpu", optional = true }
aero-edid = { path = "../aero-edid" }
aero-gpu-vga = { path = "../aero-gpu-vga" }
aero-io-snapshot = { path = "../aero-io-snapshot" }
aero-snapshot = { path = "../aero-snapshot" }
aero-smp = { path = "../aero-smp" }
aero-platform = { path = "../platform" }
aero-ipc = { path = "../aero-ipc", features = ["wasm"] }
aero-shared = { path = "../aero-shared" }
aero-net-backend = { path = "../aero-net-backend" }
aero-net-trace = { path = "../aero-net-trace" }
aero-gpu-trace = { path = "../aero-gpu-trace", optional = true }
aero-protocol = { path = "../../emulator/protocol" }
aero-gpu = { path = "../aero-gpu", optional = true }
aero-storage = { path = "../aero-storage" }
aero-storage-adapters = { path = "../aero-storage-adapters" }
anyhow = { version = "1", optional = true }
lru = "0.16"
memory = { path = "../memory" }
aero-net-stack = { path = "../aero-net-stack" }
pollster = { version = "0.3", optional = true }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
thiserror = "1"
aero-d3d11 = { path = "../aero-d3d11", optional = true }

[dev-dependencies]
anyhow = "1"
image = { version = "0.25.5", default-features = false, features = ["png", "pnm"] }
tempfile = "3"
firmware = { path = "../firmware" }
aero-net-pump = { path = "../aero-net-pump", default-features = false }

[target.'cfg(not(target_arch = "wasm32"))'.dev-dependencies]
criterion = { version = "0.5.1", default-features = false, features = ["cargo_bench_support"] }
hyper = { version = "0.14", features = ["server", "http1", "tcp"] }
proptest = "1.4"
tokio = { version = "1", features = ["fs", "io-util", "macros", "net", "process", "rt-multi-thread", "sync", "time"] }

[[bench]]
name = "dsp"
harness = false
required-features = ["legacy-audio"]

[[bench]]
name = "storage_sequential"
harness = false
