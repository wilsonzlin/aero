[package]
name = "emulator"
version = "0.1.0"
edition = "2021"
license = "MIT OR Apache-2.0"
[features]
default = []
aerogpu-native = ["dep:aero-gpu", "dep:pollster"]
aerogpu-exec = ["dep:anyhow", "dep:aero-d3d11", "dep:aero-gpu", "dep:pollster"]
# Alias for the WebGPU-backed AeroGPU command executor.
aerogpu-webgpu = ["aerogpu-exec"]
net-trace = []
# Enable verbose debug logging from the user-space network stack.
net_log = []
sinc-resampler = []
# Enable compatibility wrappers backed by the canonical storage controller crates.
#
# AHCI is always backed by `aero-devices-storage`; this feature currently toggles the NVMe wrapper
# implementation (vs the legacy in-tree model).
storage-device-crates = []
# Legacy audio stack (AC97/HDA/DSP). This is not part of the browser/WASM runtime
# path; it is retained for reference and for targeted tests.
legacy-audio = []
# Legacy deterministic SMP/APIC model + snapshot harness.
legacy-smp-model = ["dep:aero-smp-model"]
aerogpu-trace = ["dep:aero-gpu-trace"]
# Legacy AeroGPU PCI/MMIO bring-up device model + tests (legacy vendor 1AED).
aerogpu-legacy = ["dep:aero-aerogpu", "aero-aerogpu/legacy-abi"]

[dependencies]
aero-machine = { path = "../aero-machine", default-features = false }
aero-usb = { path = "../aero-usb" }
aero-devices = { path = "../devices" }
aero-devices-input = { path = "../aero-devices-input" }
aero-devices-storage = { path = "../aero-devices-storage" }
aero-devices-nvme = { path = "../aero-devices-nvme" }
aero-devices-gpu = { path = "../aero-devices-gpu" }
aero-aerogpu = { path = "../aero-aerogpu", optional = true }
aero-edid = { path = "../aero-edid" }
aero-gpu-vga = { path = "../aero-gpu-vga" }
aero-io-snapshot = { path = "../aero-io-snapshot" }
aero-snapshot = { path = "../aero-snapshot" }
aero-smp-model = { path = "../aero-smp-model", optional = true }
aero-platform = { path = "../platform" }
aero-ipc = { path = "../aero-ipc", features = ["wasm"] }
aero-shared = { path = "../aero-shared" }
aero-net-backend = { path = "../aero-net-backend" }
aero-gpu-trace = { path = "../aero-gpu-trace", optional = true }
aero-protocol = { path = "../../emulator/protocol" }
aero-gpu = { path = "../aero-gpu", optional = true }
aero-storage = { path = "../aero-storage" }
aero-storage-adapters = { path = "../aero-storage-adapters" }
anyhow = { version = "1", optional = true }
lru = "0.16"
memory = { path = "../memory" }
aero-net-stack = { path = "../aero-net-stack" }
aero-net-e1000 = { path = "../aero-net-e1000" }
aero-pcapng = { path = "../aero-pcapng" }
pollster = { version = "0.3", optional = true }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
thiserror = "1"
aero-d3d11 = { path = "../aero-d3d11", optional = true }

[dev-dependencies]
anyhow = "1"
image = { version = "0.25.5", default-features = false, features = ["png", "pnm"] }
tempfile = "3"
firmware = { path = "../firmware" }
aero-net-pump = { path = "../aero-net-pump", default-features = false }

[target.'cfg(not(target_arch = "wasm32"))'.dev-dependencies]
criterion = { version = "0.5.1", default-features = false, features = ["cargo_bench_support"] }
hyper = { version = "0.14", features = ["server", "http1", "tcp"] }
proptest = "1.4"
tokio = { version = "1", features = ["fs", "io-util", "macros", "net", "process", "rt-multi-thread", "sync", "time"] }

[[test]]
name = "boot_basic"
path = "../../tests/boot/basic_boot.rs"

[[test]]
name = "boot_sector"
path = "../../tests/boot_sector.rs"

[[test]]
name = "freedos_boot"
path = "../../tests/freedos_boot.rs"

[[test]]
name = "windows7_boot"
path = "../../tests/windows7_boot.rs"

[[bench]]
name = "dsp"
harness = false
required-features = ["legacy-audio"]

[[bench]]
name = "storage_sequential"
harness = false
