use super::LegacyBdaInfo;

pub struct LegacyModeTable {
    pub misc_output: u8,
    pub sequencer: [u8; 5],
    pub crtc: [u8; 0x19],
    pub graphics_controller: [u8; 9],
    pub attribute_controller: [u8; 0x15],
    pub bda_info: LegacyBdaInfo,
}

// These tables are standard VGA BIOS register sets (compatible with IBM VGA /
// Bochs / SeaBIOS) commonly used by VGA emulators.

const MODE_03H: LegacyModeTable = LegacyModeTable {
    misc_output: 0x67,
    sequencer: [0x03, 0x00, 0x03, 0x00, 0x02],
    crtc: [
        0x5F, 0x4F, 0x50, 0x82, 0x55, 0x81, 0xBF, 0x1F, 0x00, 0x4F, 0x0D, 0x0E, 0x00, 0x00, 0x00,
        0x00, 0x9C, 0x8E, 0x8F, 0x28, 0x1F, 0x96, 0xB9, 0xA3, 0xFF,
    ],
    graphics_controller: [0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x0E, 0x00, 0xFF],
    attribute_controller: [
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x14, 0x07, 0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E,
        0x3F, 0x0C, 0x00, 0x0F, 0x08, 0x00,
    ],
    bda_info: LegacyBdaInfo {
        video_mode: 0x03,
        columns: 80,
        rows: 25,
        page_size: 0x1000,
        text_base_segment: 0xB800,
        cursor_pos: [0; 8],
        active_page: 0,
    },
};

const MODE_13H: LegacyModeTable = LegacyModeTable {
    misc_output: 0x63,
    sequencer: [0x03, 0x01, 0x0F, 0x00, 0x0E],
    crtc: [
        0x5F, 0x4F, 0x50, 0x82, 0x54, 0x80, 0xBF, 0x1F, 0x00, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x9C, 0x8E, 0x8F, 0x28, 0x40, 0x96, 0xB9, 0xA3, 0xFF,
    ],
    graphics_controller: [0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x05, 0x0F, 0xFF],
    attribute_controller: [
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E,
        0x0F, 0x41, 0x00, 0x0F, 0x00, 0x00,
    ],
    bda_info: LegacyBdaInfo {
        video_mode: 0x13,
        columns: 40,
        rows: 25,
        page_size: 0xFA00, // 64000 bytes
        text_base_segment: 0xA000,
        cursor_pos: [0; 8],
        active_page: 0,
    },
};

const MODE_12H: LegacyModeTable = LegacyModeTable {
    misc_output: 0xE3,
    sequencer: [0x03, 0x01, 0x0F, 0x00, 0x06],
    crtc: [
        0x5F, 0x4F, 0x50, 0x82, 0x54, 0x80, 0x0B, 0x3E, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0xEA, 0x8C, 0xDF, 0x28, 0x00, 0xE7, 0x04, 0xE3, 0xFF,
    ],
    graphics_controller: [0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x05, 0x0F, 0xFF],
    attribute_controller: [
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E,
        0x0F, 0x01, 0x00, 0x0F, 0x00, 0x00,
    ],
    bda_info: LegacyBdaInfo {
        video_mode: 0x12,
        columns: 80,
        rows: 30,
        page_size: 0x9600, // 640*480/8 = 38400 bytes per plane.
        text_base_segment: 0xA000,
        cursor_pos: [0; 8],
        active_page: 0,
    },
};

pub fn legacy_mode_table(mode: u8) -> Option<&'static LegacyModeTable> {
    match mode {
        0x03 => Some(&MODE_03H),
        0x12 => Some(&MODE_12H),
        0x13 => Some(&MODE_13H),
        _ => None,
    }
}
