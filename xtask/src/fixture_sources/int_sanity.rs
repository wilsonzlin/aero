//! Deterministic 16-bit boot sector used by BIOS interrupt integration tests.
//!
//! `cargo xtask fixtures` is the **single source of truth** for
//! `tests/fixtures/boot/int_sanity.bin`.
//!
//! The original NASM source (`tests/fixtures/boot/int_sanity.asm`) is kept in-repo
//! as documentation, but CI/agents are not expected to have an assembler
//! installed.
//!
//! Behavior (see the `.asm` for readable reference):
//!   - `int 10h` teletype: prints 'A'
//!   - `int 15h` E820: writes first SMAP entry to `0000:0600`
//!   - `int 16h` read key: stores AX at `0000:0510`
//!   - `int 13h` read sector: reads CHS(0,0,2) into `0000:0700` and stores the
//!     first byte at `0000:0520`
//!   - writes `"OK"` (word) at `0000:0530` then halts

/// 16-bit machine code that the `xtask` pads to 510 bytes and appends the 0x55AA
/// boot signature.
pub const CODE: &[u8] = &[
    0xB8, 0x00, 0x00, // mov ax, 0
    0x8E, 0xD8, // mov ds, ax
    0x8E, 0xC0, // mov es, ax
    0xB4, 0x0E, // mov ah, 0x0e
    0xB0, 0x41, // mov al, 'A'
    0xCD, 0x10, // int 0x10
    0xBF, 0x00, 0x06, // mov di, 0x0600
    0x66, 0xB8, 0x20, 0xE8, 0x00, 0x00, // mov eax, 0xE820
    0x66, 0xBA, 0x50, 0x41, 0x4D, 0x53, // mov edx, 'SMAP'
    0x66, 0xB9, 0x18, 0x00, 0x00, 0x00, // mov ecx, 24
    0x66, 0xBB, 0x00, 0x00, 0x00, 0x00, // mov ebx, 0
    0xCD, 0x15, // int 0x15
    0xB4, 0x00, // mov ah, 0
    0xCD, 0x16, // int 0x16
    0xA3, 0x10, 0x05, // mov [0x0510], ax
    0xBB, 0x00, 0x07, // mov bx, 0x0700
    0xB8, 0x01, 0x02, // mov ax, 0x0201
    0xB9, 0x02, 0x00, // mov cx, 0x0002
    0xBA, 0x80, 0x00, // mov dx, 0x0080
    0xCD, 0x13, // int 0x13
    0xA0, 0x00, 0x07, // mov al, [0x0700]
    0xA2, 0x20, 0x05, // mov [0x0520], al
    0xC7, 0x06, 0x30, 0x05, 0x4F, 0x4B, // mov word [0x0530], 'OK'
    0xF4, // hlt
    0xEB, 0xFE, // jmp $
];
