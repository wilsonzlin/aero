# SPDX-License-Identifier: MIT OR Apache-2.0
#
# virtio-snd (Windows 7) - clean-room PortCls (WaveRT) audio driver.
#
# Build with the WDK 7600/7.1 "build" utility from:
#   drivers\windows7\virtio-snd
#
# x86: use the Win7 x86 Free/Checked build environment.
# x64: use the Win7 x64 Free/Checked build environment.

TARGETNAME=virtiosnd
TARGETTYPE=DRIVER
TARGETPATH=obj
#
# Include ordering matters:
# - `drivers/windows/virtio/common` provides the reusable split virtqueue engine
#   used by virtiosnd_queue_split.c and virtqueue_split.c.
# - `drivers/windows7/virtio/common/include` also contains a header named
#   `virtqueue_split.h` (legacy/transitional implementation).
# Ensure the split virtqueue engine's headers win by putting its directory
# earlier in the include path.
#
INCLUDES=$(INCLUDES);..\include;..\..\..\windows\virtio\common;..\..\virtio\common\include;..\..\..\win7\virtio\virtio-core\include;..\..\..\win7\virtio\virtio-core\portable

TARGETLIBS=$(TARGETLIBS) \
  $(DDK_LIB_PATH)\portcls.lib \
  $(DDK_LIB_PATH)\ks.lib

SOURCES= \
    adapter.c \
    adapter_context.c \
    backend_null.c \
    backend_virtio.c \
    topology.c \
    wavert.c \
    pci_interface.c \
    ..\..\virtio\common\src\virtio_pci_modern_wdm.c \
    ..\..\virtio\common\src\virtio_pci_intx_wdm.c \
    ..\..\virtio\common\src\virtio_pci_contract.c \
    virtio_snd_proto.c \
    virtiosnd_control.c \
    virtiosnd_control_proto.c \
    virtiosnd_dma.c \
    virtiosnd_queue_split.c \
    virtiosnd_tx.c \
    virtiosnd_rx.c \
    virtiosnd_hw.c \
    virtiosnd_intx.c \
    virtiosnd_sg.c \
    virtiosnd_sg_core.c \
    virtiosnd_sg_tx.c \
    ..\..\..\windows\virtio\common\virtqueue_split.c \
    ..\..\..\win7\virtio\virtio-core\portable\virtio_pci_aero_layout.c \
    ..\..\..\win7\virtio\virtio-core\portable\virtio_pci_cap_parser.c \
    ..\..\..\win7\virtio\virtio-core\portable\virtio_pci_identity.c
