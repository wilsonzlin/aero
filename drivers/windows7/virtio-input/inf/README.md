# `inf/` - driver package staging directory

This folder is intended to be the **exact directory you point Windows to** during installation:

- Device Manager → **Have Disk…** → select `aero_virtio_input.inf`
- For tablet-style virtio-input devices (absolute pointer / EV_ABS) → select `aero_virtio_tablet.inf`
- `pnputil -i -a aero_virtio_input.inf` (Windows 7)

In a finished package, this directory will contain (at minimum):

```text
aero_virtio_input.inf
aero_virtio_input.cat
aero_virtio_input.sys
aero_virtio_tablet.inf
aero_virtio_tablet.cat
```

`aero_virtio_input.cat` is generated by `Inf2Cat` and is ignored by git (see `inf/.gitignore`).

Optional legacy filename alias:

- `virtio-input.inf.disabled` is a legacy filename alias for workflows/tools that still reference `virtio-input.inf`.
  Rename it back to `virtio-input.inf` to enable the alias.
- The alias INF is checked in as `*.inf.disabled` to avoid shipping/installing **two** INFs that match the same HWIDs.

## Notes

### Static INF validation (`verify-inf.ps1`)

`..\scripts\verify-inf.ps1` performs a lightweight, regex-based validation of
`aero_virtio_input.inf` to ensure it continues to match Aero's packaging/contract
expectations (HID class, catalog filename, KMDF version, required contract v1 HWIDs,
distinct keyboard vs mouse `DeviceDesc` strings, and MSI interrupt settings).

The validator currently targets only the **keyboard/mouse** INF (`aero_virtio_input.inf`)
and expects the following contract-v1 HWIDs to be present in both `[Aero.NTx86]` and
`[Aero.NTamd64]`:

- `PCI\VEN_1AF4&DEV_1052&SUBSYS_00101AF4&REV_01` (keyboard)
- `PCI\VEN_1AF4&DEV_1052&SUBSYS_00111AF4&REV_01` (mouse)
- `PCI\VEN_1AF4&DEV_1052&REV_01` (generic fallback when subsystem IDs are not exposed)

It also enforces that `aero_virtio_input.inf` does not include the tablet subsystem ID (`SUBSYS_00121AF4`), so tablet
devices bind via `aero_virtio_tablet.inf` when that INF is installed.

Run it from any PowerShell prompt:

```powershell
..\scripts\verify-inf.ps1
```

To validate a different INF path:

```powershell
..\scripts\verify-inf.ps1 -InfPath .\aero_virtio_input.inf
```

### Catalog generation (`Inf2Cat`)

`Inf2Cat` hashes every file referenced by the INF. That means:

- `aero_virtio_input.sys` must exist in this folder before running `..\scripts\make-cat.cmd`.
  - To stage it automatically from a build output directory, run `..\scripts\stage-built-sys.ps1` (x86 or amd64).
- If you add extra payload files later (coinstallers, firmware blobs, etc), update the INF and regenerate the catalog.

### KMDF version / coinstaller

The INF declares a minimum **KMDF library version 1.9**, which is **in-box on Windows 7 SP1**.

If the driver is later built against a newer KMDF version, you will need to:

1. Update `KmdfLibraryVersion` in `aero_virtio_input.inf`
2. Add the appropriate `WdfCoInstallerXXXX.dll` to the package and reference it in the INF
3. Regenerate the catalog and re-sign

### Release packaging

Once the driver binaries exist, `..\scripts\package-release.ps1` can be used to produce a redistributable zip that:

- Includes the INF (and CAT if present) from this directory
- Pulls the built SYS (and optional KMDF coinstaller DLL) from the `-InputDir` you provide

For a one-shot local workflow (stage SYS → generate CAT → sign → zip), see `..\scripts\build-release.ps1`.
