<!doctype html>
    <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aero deploy smoke test</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <h1>Aero deploy smoke test</h1>
    <p>
      This page exists to validate that the reverse proxy is serving over <code>https://</code> and that the
      response is <em>cross-origin isolated</em> (required for <code>SharedArrayBuffer</code> + WASM threads).
    </p>

    <h2>Status</h2>
    <ul>
      <li>
        <code>window.crossOriginIsolated</code>:
        <span id="coi">…</span>
      </li>
      <li>
        <code>typeof SharedArrayBuffer</code>:
        <span id="sab">…</span>
      </li>
      <li>
        <code>location.origin</code>:
        <code id="origin">…</code>
      </li>
      <li>
        <code>GET /healthz</code>:
        <span id="health">…</span>
      </li>
      <li>
        <code>POST /session</code> (sets cookie):
        <span id="session">…</span>
      </li>
      <li>
        <code>WSS /tcp</code> upgrade (<code>example.com:80</code>):
        <span id="ws">…</span>
      </li>
      <li>
        <code>WSS /l2</code> upgrade (<code>aero-l2-tunnel-v1</code>):
        <span id="ws-l2">…</span>
      </li>
    </ul>

    <p>
      If your <code>/l2</code> endpoint requires token/JWT auth (for example
      <code>AERO_L2_AUTH_MODE=token</code> (legacy alias: <code>api_key</code>) or <code>jwt</code>), load this page with
      <code>#l2Token=...</code> and optionally <code>&amp;l2TokenTransport=subprotocol|query|both</code>.
      (The fragment is not sent to the server; the default transport is <code>subprotocol</code>.)
    </p>

    <h2>Quick checks</h2>
    <pre><code id="checks">…</code></pre>

    <script type="module" src="./main.js"></script>
  </body>
</html>
