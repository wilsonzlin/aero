/**
 * Minimal WASM payloads used by the browser-side JIT pipeline smoke test.
 *
 * Real Aero will generate these bytes dynamically from guest code (via the Rust
 * JIT compiled to wasm-bindgen), but the worker glue pipeline is identical.
 */

export const SHARED_MEMORY_INITIAL_PAGES = 1;
export const SHARED_MEMORY_MAX_PAGES = 16;

// WASM module representing a tiny "CPU runtime" that owns the shared table and exports helpers
// the JIT blocks can import.
export const CPU_RUNTIME_WASM_BYTES = new Uint8Array([
  0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x0d, 0x03, 0x60,
  0x00, 0x00, 0x60, 0x01, 0x7f, 0x00, 0x60, 0x02, 0x7f, 0x7f, 0x00, 0x02,
  0x1f, 0x02, 0x03, 0x65, 0x6e, 0x76, 0x06, 0x6d, 0x65, 0x6d, 0x6f, 0x72,
  0x79, 0x02, 0x03, 0x01, 0x10, 0x03, 0x65, 0x6e, 0x76, 0x05, 0x74, 0x61,
  0x62, 0x6c, 0x65, 0x01, 0x70, 0x01, 0x00, 0x40, 0x03, 0x04, 0x03, 0x00,
  0x01, 0x02, 0x07, 0x2d, 0x03, 0x0a, 0x6a, 0x69, 0x74, 0x5f, 0x68, 0x65,
  0x6c, 0x70, 0x65, 0x72, 0x00, 0x00, 0x08, 0x63, 0x61, 0x6c, 0x6c, 0x5f,
  0x6a, 0x69, 0x74, 0x00, 0x01, 0x11, 0x69, 0x6e, 0x73, 0x74, 0x61, 0x6c,
  0x6c, 0x5f, 0x6a, 0x69, 0x74, 0x5f, 0x62, 0x6c, 0x6f, 0x63, 0x6b, 0x00,
  0x02, 0x0a, 0x2a, 0x03, 0x0f, 0x00, 0x41, 0x04, 0x41, 0x04, 0x28, 0x02,
  0x00, 0x41, 0x01, 0x6a, 0x36, 0x02, 0x00, 0x0b, 0x07, 0x00, 0x20, 0x00,
  0x11, 0x00, 0x00, 0x0b, 0x10, 0x00, 0x41, 0x0c, 0x20, 0x01, 0x36, 0x02,
  0x00, 0x41, 0x10, 0x20, 0x00, 0x36, 0x02, 0x00, 0x0b,
]) as Uint8Array<ArrayBuffer>;

// WASM module exporting `jit_helper()`, which increments i32 at memory offset 4.
export const CPU_HELPER_WASM_BYTES = new Uint8Array([
  0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00,
  0x01, 0x04, 0x01, 0x60, 0x00, 0x00,
  0x02, 0x10, 0x01, 0x03, 0x65, 0x6e, 0x76, 0x06, 0x6d, 0x65, 0x6d, 0x6f,
  0x72, 0x79, 0x02, 0x03, 0x01, 0x10,
  0x03, 0x02, 0x01, 0x00,
  0x07, 0x0e, 0x01, 0x0a, 0x6a, 0x69, 0x74, 0x5f, 0x68, 0x65, 0x6c, 0x70,
  0x65, 0x72, 0x00, 0x00,
  0x0a, 0x11, 0x01, 0x0f, 0x00, 0x41, 0x04, 0x41, 0x04, 0x28, 0x02, 0x00,
  0x41, 0x01, 0x6a, 0x36, 0x02, 0x00, 0x0b,
]) as Uint8Array<ArrayBuffer>;

// WASM module exporting a Tier-1-style `block(cpu_ptr, jit_ctx_ptr) -> i64`.
//
// This synthetic block is used to validate browser-side rollback behavior:
// - mutate CPU state in-place (RAX += 1)
// - perform a guest RAM store via the `env.mem_write_u32` helper
// - trigger a runtime bailout via `env.jit_exit`, returning the sentinel `-1`
//
// On the JS host side, `__aero_jit_call` must roll back both CPU state and guest RAM writes
// when it observes a sentinel return and a runtime exit flag (`jit_exit`/`mmio_exit`/`page_fault`).
export const JIT_BLOCK_WASM_BYTES = new Uint8Array([
  0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x13, 0x03, 0x60, 0x03, 0x7f, 0x7e, 0x7f,
  0x00, 0x60, 0x02, 0x7f, 0x7e, 0x01, 0x7e, 0x60, 0x02, 0x7f, 0x7f, 0x01, 0x7e, 0x02, 0x33,
  0x03, 0x03, 0x65, 0x6e, 0x76, 0x06, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x02, 0x03, 0x01,
  0x10, 0x03, 0x65, 0x6e, 0x76, 0x0d, 0x6d, 0x65, 0x6d, 0x5f, 0x77, 0x72, 0x69, 0x74, 0x65,
  0x5f, 0x75, 0x33, 0x32, 0x00, 0x00, 0x03, 0x65, 0x6e, 0x76, 0x08, 0x6a, 0x69, 0x74, 0x5f,
  0x65, 0x78, 0x69, 0x74, 0x00, 0x01, 0x03, 0x02, 0x01, 0x02, 0x07, 0x09, 0x01, 0x05, 0x62,
  0x6c, 0x6f, 0x63, 0x6b, 0x00, 0x02, 0x0a, 0x38, 0x01, 0x36, 0x01, 0x01, 0x7e, 0x20, 0x00,
  0x29, 0x03, 0x00, 0x42, 0x01, 0x7c, 0x21, 0x02, 0x20, 0x00, 0x20, 0x02, 0x37, 0x03, 0x00,
  0x20, 0x00, 0x42, 0x80, 0x04, 0x41, 0xf8, 0xac, 0xd1, 0x91, 0x01, 0x10, 0x00, 0x41, 0x00,
  0x42, 0x99, 0xb3, 0x02, 0x10, 0x01, 0x21, 0x02, 0x20, 0x00, 0x20, 0x02, 0x37, 0x03, 0x80,
  0x01, 0x42, 0x7f, 0x0b,
]) as Uint8Array<ArrayBuffer>;

// WASM module exporting `block(cpu_ptr: i32, jit_ctx_ptr: i32) -> i64` and importing Tier-1 slow-path helpers
// that use i64. This exists purely to exercise the JS BigInt glue used by Tier-1 JIT blocks in the browser.
export const JIT_BIGINT_ABI_WASM_BYTES = new Uint8Array([
  0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x55, 0x0d, 0x60,
  0x02, 0x7f, 0x7e, 0x01, 0x7f, 0x60, 0x02, 0x7f, 0x7e, 0x01, 0x7f, 0x60,
  0x02, 0x7f, 0x7e, 0x01, 0x7f, 0x60, 0x02, 0x7f, 0x7e, 0x01, 0x7e, 0x60,
  0x03, 0x7f, 0x7e, 0x7f, 0x00, 0x60, 0x03, 0x7f, 0x7e, 0x7f, 0x00, 0x60,
  0x03, 0x7f, 0x7e, 0x7f, 0x00, 0x60, 0x03, 0x7f, 0x7e, 0x7e, 0x00, 0x60,
  0x04, 0x7f, 0x7f, 0x7e, 0x7f, 0x01, 0x7e, 0x60, 0x02, 0x7f, 0x7e, 0x01,
  0x7e, 0x60, 0x06, 0x7f, 0x7e, 0x7f, 0x7f, 0x7e, 0x7e, 0x01, 0x7e, 0x60,
  0x02, 0x7f, 0x7e, 0x01, 0x7e, 0x60, 0x02, 0x7f, 0x7f, 0x01, 0x7e, 0x02,
  0xf2, 0x01, 0x0d, 0x03, 0x65, 0x6e, 0x76, 0x06, 0x6d, 0x65, 0x6d, 0x6f,
  0x72, 0x79, 0x02, 0x03, 0x01, 0x10, 0x03, 0x65, 0x6e, 0x76, 0x0b, 0x6d,
  0x65, 0x6d, 0x5f, 0x72, 0x65, 0x61, 0x64, 0x5f, 0x75, 0x38, 0x00, 0x00,
  0x03, 0x65, 0x6e, 0x76, 0x0c, 0x6d, 0x65, 0x6d, 0x5f, 0x72, 0x65, 0x61,
  0x64, 0x5f, 0x75, 0x31, 0x36, 0x00, 0x01, 0x03, 0x65, 0x6e, 0x76, 0x0c,
  0x6d, 0x65, 0x6d, 0x5f, 0x72, 0x65, 0x61, 0x64, 0x5f, 0x75, 0x33, 0x32,
  0x00, 0x02, 0x03, 0x65, 0x6e, 0x76, 0x0c, 0x6d, 0x65, 0x6d, 0x5f, 0x72,
  0x65, 0x61, 0x64, 0x5f, 0x75, 0x36, 0x34, 0x00, 0x03, 0x03, 0x65, 0x6e,
  0x76, 0x0c, 0x6d, 0x65, 0x6d, 0x5f, 0x77, 0x72, 0x69, 0x74, 0x65, 0x5f,
  0x75, 0x38, 0x00, 0x04, 0x03, 0x65, 0x6e, 0x76, 0x0d, 0x6d, 0x65, 0x6d,
  0x5f, 0x77, 0x72, 0x69, 0x74, 0x65, 0x5f, 0x75, 0x31, 0x36, 0x00, 0x05,
  0x03, 0x65, 0x6e, 0x76, 0x0d, 0x6d, 0x65, 0x6d, 0x5f, 0x77, 0x72, 0x69,
  0x74, 0x65, 0x5f, 0x75, 0x33, 0x32, 0x00, 0x06, 0x03, 0x65, 0x6e, 0x76,
  0x0d, 0x6d, 0x65, 0x6d, 0x5f, 0x77, 0x72, 0x69, 0x74, 0x65, 0x5f, 0x75,
  0x36, 0x34, 0x00, 0x07, 0x03, 0x65, 0x6e, 0x76, 0x0d, 0x6d, 0x6d, 0x75,
  0x5f, 0x74, 0x72, 0x61, 0x6e, 0x73, 0x6c, 0x61, 0x74, 0x65, 0x00, 0x08,
  0x03, 0x65, 0x6e, 0x76, 0x0a, 0x70, 0x61, 0x67, 0x65, 0x5f, 0x66, 0x61,
  0x75, 0x6c, 0x74, 0x00, 0x09, 0x03, 0x65, 0x6e, 0x76, 0x0d, 0x6a, 0x69,
  0x74, 0x5f, 0x65, 0x78, 0x69, 0x74, 0x5f, 0x6d, 0x6d, 0x69, 0x6f, 0x00,
  0x0a, 0x03, 0x65, 0x6e, 0x76, 0x08, 0x6a, 0x69, 0x74, 0x5f, 0x65, 0x78,
  0x69, 0x74, 0x00, 0x0b, 0x03, 0x02, 0x01, 0x0c, 0x07, 0x09, 0x01, 0x05,
  0x62, 0x6c, 0x6f, 0x63, 0x6b, 0x00, 0x0c, 0x0a, 0x52, 0x01, 0x50, 0x01,
  0x01, 0x7e, 0x20, 0x00, 0x42, 0x00, 0x10, 0x00, 0x1a, 0x20, 0x00, 0x42,
  0x02, 0x10, 0x01, 0x1a, 0x20, 0x00, 0x42, 0x04, 0x10, 0x02, 0x1a, 0x20,
  0x00, 0x42, 0x08, 0x10, 0x03, 0x21, 0x02, 0x20, 0x00, 0x42, 0x10, 0x20,
  0x02, 0x10, 0x07, 0x20, 0x00, 0x20, 0x01, 0x42, 0x00, 0x41, 0x00, 0x10,
  0x08, 0x1a, 0x20, 0x00, 0x42, 0x00, 0x10, 0x09, 0x1a, 0x20, 0x00, 0x42,
  0x00, 0x41, 0x00, 0x41, 0x08, 0x42, 0x7f, 0x42, 0x00, 0x10, 0x0a, 0x1a,
  0x20, 0x00, 0x42, 0x00, 0x10, 0x0b, 0x0b,
]) as Uint8Array<ArrayBuffer>;

export function copyWasmBytes(bytes: Uint8Array<ArrayBuffer>): Uint8Array<ArrayBuffer> {
  return new Uint8Array(bytes) as Uint8Array<ArrayBuffer>;
}
